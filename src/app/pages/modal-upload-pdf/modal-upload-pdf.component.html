<h2 mat-dialog-title>{{ data.id ? 'Editar Historia Clínica (PDF)' : 'Subir Historia Clínica (PDF)' }}</h2>
<mat-dialog-content class="mat-typography">
    <form [formGroup]="uploadForm" class="upload-form">

        <div class="row">
            <div class="col-md-12">
                <mat-form-field appearance="outline" class="w-100">
                    <mat-label>Nombre</mat-label>
                    <input matInput formControlName="nombre" placeholder="Nombre del documento">
                    <mat-error *ngIf="uploadForm.get('nombre')?.hasError('required')">
                        El nombre es requerido
                    </mat-error>
                </mat-form-field>
            </div>

            <div class="col-md-6">
                <mat-form-field appearance="outline" class="w-100">
                    <mat-label>Fecha</mat-label>
                    <input matInput [matDatepicker]="picker" formControlName="fecha">
                    <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                    <mat-error *ngIf="uploadForm.get('fecha')?.hasError('required')">
                        La fecha es requerida
                    </mat-error>
                </mat-form-field>
            </div>

            <div class="col-md-6">
                <mat-form-field appearance="outline" class="w-100">
                    <mat-label>Centro de Salud</mat-label>
                    <mat-select formControlName="centro_salud_id">
                        <mat-option *ngFor="let center of healthCenters" [value]="center.id">
                            {{ center.nombre }}
                        </mat-option>
                    </mat-select>
                    <mat-error *ngIf="uploadForm.get('centro_salud_id')?.hasError('required')">
                        El centro de salud es requerido
                    </mat-error>
                </mat-form-field>
            </div>
        </div>

        <div class="upload-container">
            <div *ngIf="!selectedFile" class="drop-zone">
                <mat-icon class="upload-icon">cloud_upload</mat-icon>
                <p>Arrastra tu archivo aquí o haz clic para seleccionar</p>
                <input type="file" (change)="onFileSelected($event)" accept=".pdf" #fileInput hidden>
                <button mat-raised-button color="primary" type="button" (click)="fileInput.click()">Seleccionar
                    Archivo</button>
            </div>

            <div *ngIf="selectedFile" class="file-preview">
                <mat-icon class="pdf-icon">picture_as_pdf</mat-icon>
                <span class="file-name">{{ selectedFile.name }}</span>
                <button mat-icon-button color="warn" type="button" (click)="removeFile()" [disabled]="isUploading">
                    <mat-icon>close</mat-icon>
                </button>
            </div>

            <mat-progress-bar *ngIf="isUploading" mode="indeterminate"></mat-progress-bar>
        </div>

    </form>
</mat-dialog-content>
<mat-dialog-actions align="end">
    <button mat-button mat-dialog-close [disabled]="isUploading">Cancelar</button>
    <button mat-raised-button color="primary" (click)="uploadFile()"
        [disabled]="!selectedFile || uploadForm.invalid || isUploading">
        {{ isUploading ? 'Subiendo...' : 'Subir' }}
    </button>
</mat-dialog-actions>