<div class="p-4 p-md-5">

  <div class="container-xl">

    <!-- Encabezado -->
    <div class="d-flex flex-wrap justify-content-between align-items-center gap-3 mb-4">
      <p class="h3 fw-bold text-dark mb-0">Tus historias clinicas</p>
      <div class="d-flex justify-content-center align-items-center" style="cursor: pointer" (click)="logout()">
        <i class="material-symbols-outlined">logout</i>
        <span class="fw-bold text-dark mb-0">Salir</span>
      </div>
    </div>

    <!-- Buscador y filtros -->
    <div class="row g-3 mb-4">

      <!-- Barra de búsqueda -->
      <div class="col-12 col-md-8 col-lg-8">
        <label class="w-100">
          <div class="input-group">
            <span class="input-group-text bg-white border-end-0 text-secondary">
              <span class="material-symbols-outlined">search</span>
              <input type="text" class="form-control border-0" placeholder="Buscar por nombre, doctor o fecha..."
                [(ngModel)]="searchTerm" (ngModelChange)="filterHistories()">
            </span>
          </div>
        </label>
      </div>

      <!-- Filtros -->

      <!-- Tabla -->
      <div class="table-responsive rounded-3 border shadow-sm">
        <table class="table align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th scope="col" class="text-uppercase small fw-semibold">Nombre</th>
              <th scope="col" class="text-uppercase small fw-semibold">Doctor</th>
              <th scope="col" class="text-uppercase small fw-semibold">Fecha</th>
              <th scope="col" class="text-end text-uppercase small fw-semibold">Acciones</th>
            </tr>
          </thead>
          <tbody>
            @for (history of filteredHistories; track history) {
            <tr>
              <td>
                <div class="fw-semibold text-dark">{{ history.nombre }}</div>
                <div class="text-muted small">{{ history.centro_salud?.nombre || history.centro_salud_id }}</div>
              </td>
              <td class="text-muted small">{{ history.doctor?.nombre }}</td>
              <td class="text-muted small">{{ history.fecha }}</td>
              <td class="text-end">
                <div class="d-flex justify-content-end gap-3">
                  <span class="text-decoration-none text-secondary d-flex align-items-center gap-1"
                    style="cursor: pointer" (click)="seeHistory(history.archivo_url)">
                    <span class="material-symbols-outlined fs-6">visibility</span> Previsualizar
                  </span>
                </div>
              </td>
            </tr>
            }
            @if (filteredHistories.length === 0) {
            <tr>
              <td colspan="5" class="text-center py-5">
                <div class="d-flex flex-column align-items-center gap-3">
                  <span class="material-symbols-outlined fs-1 text-secondary">upcoming</span>
                  <h5 class="fw-semibold mb-0">No se encontraron historias</h5>
                  <p class="text-muted small mb-0">Sus historias clínicas aparecerán aquí una vez estén disponibles.</p>
                </div>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>

    </div>
  </div>